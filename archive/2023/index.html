<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Mike Tupker"><link href=https://www.practicalkungfu.net/archive/2023/ rel=canonical><link rel=alternate type=application/rss+xml title="RSS feed" href=../../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="RSS feed of updated content" href=../../feed_rss_updated.xml><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.8"><title>2023 - PracticalKungFu.net</title><link rel=stylesheet href=../../assets/stylesheets/main.4b4a2bd9.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.356b1318.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><!-- <script>
  /* Add custom analytics integration here, e.g. */
  var property = "cloudflare"

  defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "abc9f23fa28140249d8963fe2c85940a"}'

  /* Wait for page to load and application to mount */
  document.addEventListener("DOMContentLoaded", function() {
    location$.subscribe(function(url) {
      /* Add custom page event tracking here */ 
    })
  })
</script> --><!-- Cloudflare Web Analytics --><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "abc9f23fa28140249d8963fe2c85940a"}'></script><!-- End Cloudflare Web Analytics --><!-- Clicky analytics --><script async data-id=101432599 src=//static.getclicky.com/js></script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#2023 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=PracticalKungFu.net class="md-header__button md-logo" aria-label=PracticalKungFu.net data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> PracticalKungFu.net </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 2023 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/PracticalKungFu/practicalkungfu.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> practicalkungfu.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=PracticalKungFu.net class="md-nav__button md-logo" aria-label=PracticalKungFu.net data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> PracticalKungFu.net </label> <div class=md-nav__source> <a href=https://github.com/PracticalKungFu/practicalkungfu.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> practicalkungfu.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Articles </span> </a> </li> <li class=md-nav__item> <a href=../../about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#poor-mans-connection-monitoring class=md-nav__link> Poor Mans Connection Monitoring </a> </li> <li class=md-nav__item> <a href=#greenshot-intune-deployment class=md-nav__link> Greenshot Intune Deployment </a> </li> <li class=md-nav__item> <a href=#btop-is-best-top class=md-nav__link> btop is Best Top </a> </li> <li class=md-nav__item> <a href=#ms-dns-logging class=md-nav__link> MS DNS Logging </a> </li> <li class=md-nav__item> <a href=#force-ad-replication class=md-nav__link> Force AD Replication </a> </li> <li class=md-nav__item> <a href=#configure-windows-time class=md-nav__link> Configure Windows Time </a> </li> <li class=md-nav__item> <a href=#cleanup-winsxs class=md-nav__link> Cleanup WinSXS </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=2023>2023</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://avatars.githubusercontent.com/u/6422631 alt="Mike Tupker"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-10 00:00:00">November 10, 2023</time></li> <li class=md-meta__item> in <a href=../../category/powershell/ class=md-meta__link>Powershell</a>, <a href=../../category/scripting/ class=md-meta__link>Scripting</a></li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=poor-mans-connection-monitoring><a href=../../2023/11/10/poor-mans-connection-monitoring/ class=toclink>Poor Mans Connection Monitoring</a></h2> <p>This morning I had need to be alerted if I ping starts failing in an ad-hoc situation. The below script does a test ping and then beeps if the ping fails. It'll loop endlessly.</p> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>while</span> <span class=p>(</span><span class=nv>$true</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=nv>$ping</span> <span class=p>=</span> <span class=nb>Test-Connection</span> <span class=n>-ComputerName</span> <span class=n>10</span><span class=p>.</span><span class=n>120</span><span class=p>.</span><span class=n>10</span><span class=p>.</span><span class=n>100</span> <span class=n>-Count</span> <span class=n>1</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=nv>$ping</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=nb>Start-Sleep</span> <span class=n>-Seconds</span> <span class=n>1</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>    <span class=k>If</span> <span class=p>((</span><span class=nv>$ping</span> <span class=o>-eq</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-or</span> <span class=p>(</span><span class=nv>$ping</span> <span class=o>-eq</span> <span class=nv>$null</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>        <span class=no>[console]</span><span class=p>::</span><span class=n>beep</span><span class=p>(</span><span class=n>500</span><span class=p>,</span><span class=n>1000</span><span class=p>)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>    <span class=p>}</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=p>}</span>
</span></code></pre></div> <nav class=md-post__action> <a href=../../2023/11/10/poor-mans-connection-monitoring/ > Continue reading </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://avatars.githubusercontent.com/u/6422631 alt="Mike Tupker"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-09 00:00:00">November 9, 2023</time></li> <li class=md-meta__item> in <a href=../../category/intune/ class=md-meta__link>Intune</a>, <a href=../../category/powershell/ class=md-meta__link>Powershell</a></li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=greenshot-intune-deployment><a href=../../2023/11/09/greenshot-intune-deployment/ class=toclink>Greenshot Intune Deployment</a></h2> <p>Greenshot is a very nice program. However there is one thing that REALLY annoys me about it. The hard coded browser poppup after install. Deploying Greenshot via Intune is not the most straight foward thing if you want to customize the install. Plus there is having to kill greenshot running under the deploy account (usually system) and also starting greenshot under the current logged on user after install.</p> <p>For this I used <a href=https://github.com/FlorianSLZ/scloud/blob/main/winget/winget-program-template/winget-program-template.zip>this intune winget template</a>. It consists of your usual detection, install, and uninstall scripts. Below I'll be going over the install script.</p> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>Param</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=p>(</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=p>[</span><span class=k>parameter</span><span class=p>(</span><span class=k>Mandatory</span><span class=p>=</span><span class=nv>$false</span><span class=p>)]</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=no>[String[]]</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>    <span class=nv>$param</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>    <span class=p>)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c>#Attempt to stop greenshot if not kill it with fire</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=s2>&quot;$ENV:ProgramFiles\Greenshot\Greenshot.exe&quot;</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>    <span class=nb>Start-Process</span> <span class=n>-FilePath</span> <span class=s2>&quot;$ENV:ProgramFiles\Greenshot\Greenshot.exe /exit&quot;</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=p>}</span> <span class=k>else</span> <span class=p>{}</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=nb>Start-Sleep</span> <span class=n>-Seconds</span> <span class=n>10</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=nb>Stop-Process</span> <span class=n>-Name</span> <span class=n>greenshot</span> <span class=n>-Force</span> <span class=n>-Confirm</span><span class=p>:</span><span class=nv>$false</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=c>#create custom installer settings and save to temp location.</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=nv>$custominf</span> <span class=p>=</span> <span class=sh>@&#39;</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=sh>[Setup]</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=sh>Lang=en</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=sh>Group=Greenshot</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=sh>NoIcons=0</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=sh>SetupType=custom</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=sh>Components=greenshot,plugins\office,plugins\ocr,plugins\externalcommand</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=sh>Tasks=startup</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=sh>&#39;@</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=nb>New-Item</span> <span class=n>C</span><span class=p>:\</span><span class=n>temp</span><span class=p>\</span><span class=n>custom</span><span class=p>.</span><span class=n>inf</span> <span class=n>-Force</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=nb>Set-Content</span> <span class=n>C</span><span class=p>:\</span><span class=n>temp</span><span class=p>\</span><span class=n>custom</span><span class=p>.</span><span class=n>inf</span> <span class=nv>$custominf</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=c># do the actual install of greenshot using winget and the custom settings we saved in the last step</span>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=nv>$ProgramName</span> <span class=p>=</span> <span class=s2>&quot;Greenshot.Greenshot&quot;</span>
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=nv>$Path_local</span> <span class=p>=</span> <span class=s2>&quot;$Env:Programfiles\_MEM&quot;</span>
</span><span id=__span-1-34><a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=nb>Start-Transcript</span> <span class=n>-Path</span> <span class=s2>&quot;$Path_local\Log\$ProgramName-install.log&quot;</span> <span class=n>-Force</span> <span class=n>-Append</span>
</span><span id=__span-1-35><a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a>
</span><span id=__span-1-36><a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=c># resolve winget_exe</span>
</span><span id=__span-1-37><a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=nv>$winget_exe</span> <span class=p>=</span> <span class=nb>Resolve-Path</span> <span class=s2>&quot;C:\Program Files\WindowsApps\Microsoft.DesktopAppInstaller_*_x64__8wekyb3d8bbwe\winget.exe&quot;</span>
</span><span id=__span-1-38><a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=k>if</span> <span class=p>(</span><span class=nv>$winget_exe</span><span class=p>.</span><span class=n>count</span> <span class=o>-gt</span> <span class=n>1</span><span class=p>){</span>
</span><span id=__span-1-39><a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a>        <span class=nv>$winget_exe</span> <span class=p>=</span> <span class=nv>$winget_exe</span><span class=p>[-</span><span class=n>1</span><span class=p>].</span><span class=n>Path</span>
</span><span id=__span-1-40><a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=p>}</span>
</span><span id=__span-1-41><a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a>
</span><span id=__span-1-42><a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=k>if</span> <span class=p>(!</span><span class=nv>$winget_exe</span><span class=p>){</span><span class=nb>Write-Error</span> <span class=s2>&quot;Winget not installed&quot;</span><span class=p>}</span>
</span><span id=__span-1-43><a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a>
</span><span id=__span-1-44><a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a><span class=p>&amp;</span> <span class=nv>$winget_exe</span> <span class=n>install</span> <span class=p>-</span><span class=o>-exact</span> <span class=p>-</span><span class=n>-id</span> <span class=nv>$ProgramName</span> <span class=p>-</span><span class=n>-silent</span> <span class=p>-</span><span class=n>-accept-package-agreements</span> <span class=p>-</span><span class=n>-accept-source-agreements</span> <span class=p>-</span><span class=n>-scope</span><span class=p>=</span><span class=n>machine</span> <span class=nv>$param</span> <span class=p>-</span><span class=n>-override</span> <span class=s2>&quot;/LOADINF=C:\temp\custom.inf /NORESTART /VERYSILENT&quot;</span>
</span><span id=__span-1-45><a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a>
</span><span id=__span-1-46><a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a>
</span><span id=__span-1-47><a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a><span class=c>#create a fixted settings file and copy it to the greenshot install directory. These settings are enforced in the app.</span>
</span><span id=__span-1-48><a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a><span class=nv>$fixedsettings</span> <span class=p>=</span> <span class=sh>@&#39;</span>
</span><span id=__span-1-49><a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a><span class=sh>[Core]</span>
</span><span id=__span-1-50><a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a><span class=sh>; The language in IETF format (e.g. en-US)</span>
</span><span id=__span-1-51><a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a><span class=sh>Language=en-US</span>
</span><span id=__span-1-52><a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a><span class=sh>; Comma separated list of Plugins which are allowed. If something in the list, than every plugin not in the list will not be loaded!</span>
</span><span id=__span-1-53><a id=__codelineno-1-53 name=__codelineno-1-53 href=#__codelineno-1-53></a><span class=sh>IncludePlugins=External command Plugin,OCR Plugin,Office Plugin</span>
</span><span id=__span-1-54><a id=__codelineno-1-54 name=__codelineno-1-54 href=#__codelineno-1-54></a><span class=sh>; Comma separated list of Plugins which are NOT allowed.</span>
</span><span id=__span-1-55><a id=__codelineno-1-55 name=__codelineno-1-55 href=#__codelineno-1-55></a><span class=sh>ExcludePlugins=</span>
</span><span id=__span-1-56><a id=__codelineno-1-56 name=__codelineno-1-56 href=#__codelineno-1-56></a><span class=sh>; Comma separated list of destinations which should be disabled.</span>
</span><span id=__span-1-57><a id=__codelineno-1-57 name=__codelineno-1-57 href=#__codelineno-1-57></a><span class=sh>ExcludeDestinations=Box,Confluence,Dropbox,Flickr,Imgur,Jira,Photobucket,Picasa,</span>
</span><span id=__span-1-58><a id=__codelineno-1-58 name=__codelineno-1-58 href=#__codelineno-1-58></a><span class=sh>; How many days between every update check? (0=no checks)</span>
</span><span id=__span-1-59><a id=__codelineno-1-59 name=__codelineno-1-59 href=#__codelineno-1-59></a><span class=sh>; UpdateCheckInterval=0</span>
</span><span id=__span-1-60><a id=__codelineno-1-60 name=__codelineno-1-60 href=#__codelineno-1-60></a><span class=sh>&#39;@</span>
</span><span id=__span-1-61><a id=__codelineno-1-61 name=__codelineno-1-61 href=#__codelineno-1-61></a>
</span><span id=__span-1-62><a id=__codelineno-1-62 name=__codelineno-1-62 href=#__codelineno-1-62></a><span class=k>if</span> <span class=p>(</span><span class=o>-Not</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=s2>&quot;$ENV:ProgramFiles\Greenshot\Greenshot-fixed.ini&quot;</span><span class=p>))</span> <span class=p>{</span>
</span><span id=__span-1-63><a id=__codelineno-1-63 name=__codelineno-1-63 href=#__codelineno-1-63></a>    <span class=nb>New-Item</span> <span class=s2>&quot;$ENV:ProgramFiles\Greenshot\Greenshot-fixed.ini&quot;</span>
</span><span id=__span-1-64><a id=__codelineno-1-64 name=__codelineno-1-64 href=#__codelineno-1-64></a>    <span class=nb>Set-Content</span> <span class=s2>&quot;$ENV:ProgramFiles\Greenshot\Greenshot-fixed.ini&quot;</span> <span class=nv>$fixedsettings</span>
</span><span id=__span-1-65><a id=__codelineno-1-65 name=__codelineno-1-65 href=#__codelineno-1-65></a><span class=p>}</span>
</span><span id=__span-1-66><a id=__codelineno-1-66 name=__codelineno-1-66 href=#__codelineno-1-66></a>
</span><span id=__span-1-67><a id=__codelineno-1-67 name=__codelineno-1-67 href=#__codelineno-1-67></a>
</span><span id=__span-1-68><a id=__codelineno-1-68 name=__codelineno-1-68 href=#__codelineno-1-68></a><span class=c>#here is the method I&#39;ve been using to get around the forced browser poppup.</span>
</span><span id=__span-1-69><a id=__codelineno-1-69 name=__codelineno-1-69 href=#__codelineno-1-69></a><span class=c>#stop deploy user browser instances and greenshot</span>
</span><span id=__span-1-70><a id=__codelineno-1-70 name=__codelineno-1-70 href=#__codelineno-1-70></a><span class=nb>Get-Process</span> <span class=n>iexplore</span> <span class=n>-IncludeUserName</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=n>UserName</span> <span class=o>-match</span> <span class=nv>$env:username</span> <span class=p>|</span> <span class=nb>Stop-Process</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span><span id=__span-1-71><a id=__codelineno-1-71 name=__codelineno-1-71 href=#__codelineno-1-71></a><span class=nb>Get-Process</span> <span class=n>chrome</span> <span class=n>-IncludeUserName</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=n>UserName</span> <span class=o>-match</span> <span class=nv>$env:username</span> <span class=p>|</span> <span class=nb>Stop-Process</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span><span id=__span-1-72><a id=__codelineno-1-72 name=__codelineno-1-72 href=#__codelineno-1-72></a><span class=nb>Get-Process</span> <span class=n>msedge</span> <span class=n>-IncludeUserName</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=n>UserName</span> <span class=o>-match</span> <span class=nv>$env:username</span> <span class=p>|</span> <span class=nb>Stop-Process</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span><span id=__span-1-73><a id=__codelineno-1-73 name=__codelineno-1-73 href=#__codelineno-1-73></a><span class=nb>Get-Process</span> <span class=n>greenshot</span> <span class=n>-IncludeUserName</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=n>UserName</span> <span class=o>-match</span> <span class=nv>$env:username</span> <span class=p>|</span> <span class=nb>Stop-Process</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span><span id=__span-1-74><a id=__codelineno-1-74 name=__codelineno-1-74 href=#__codelineno-1-74></a>
</span><span id=__span-1-75><a id=__codelineno-1-75 name=__codelineno-1-75 href=#__codelineno-1-75></a>
</span><span id=__span-1-76><a id=__codelineno-1-76 name=__codelineno-1-76 href=#__codelineno-1-76></a><span class=c>#start greenshot as logged on user</span>
</span><span id=__span-1-77><a id=__codelineno-1-77 name=__codelineno-1-77 href=#__codelineno-1-77></a><span class=c>#temporarily download psexec to temp location.</span>
</span><span id=__span-1-78><a id=__codelineno-1-78 name=__codelineno-1-78 href=#__codelineno-1-78></a><span class=c>#run greenshot via the console session (vdi might require another solution)</span>
</span><span id=__span-1-79><a id=__codelineno-1-79 name=__codelineno-1-79 href=#__codelineno-1-79></a><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=s2>&quot;$ENV:ProgramFiles\Greenshot\Greenshot.exe&quot;</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-1-80><a id=__codelineno-1-80 name=__codelineno-1-80 href=#__codelineno-1-80></a>    <span class=nv>$source</span> <span class=p>=</span> <span class=s1>&#39;https://live.sysinternals.com/PsExec.exe&#39;</span>
</span><span id=__span-1-81><a id=__codelineno-1-81 name=__codelineno-1-81 href=#__codelineno-1-81></a>    <span class=nv>$destination</span> <span class=p>=</span> <span class=s1>&#39;C:\temp\PsExec.exe&#39;</span>
</span><span id=__span-1-82><a id=__codelineno-1-82 name=__codelineno-1-82 href=#__codelineno-1-82></a>    <span class=nb>Invoke-WebRequest</span> <span class=n>-Uri</span> <span class=nv>$source</span> <span class=n>-OutFile</span> <span class=nv>$destination</span>
</span><span id=__span-1-83><a id=__codelineno-1-83 name=__codelineno-1-83 href=#__codelineno-1-83></a>    <span class=p>.\</span><span class=n>PsExec</span><span class=p>.</span><span class=n>exe</span> <span class=n>-accepteula</span> <span class=n>-i</span> <span class=n>-d</span> <span class=s2>&quot;$ENV:ProgramFiles\Greenshot\greenshot.exe&quot;</span>
</span><span id=__span-1-84><a id=__codelineno-1-84 name=__codelineno-1-84 href=#__codelineno-1-84></a>    <span class=nb>Remove-Item</span> <span class=n>C</span><span class=p>:\</span><span class=n>temp</span><span class=p>\</span><span class=n>PsExec</span><span class=p>.</span><span class=n>exe</span> <span class=n>-Confirm</span><span class=p>:</span><span class=nv>$false</span>
</span><span id=__span-1-85><a id=__codelineno-1-85 name=__codelineno-1-85 href=#__codelineno-1-85></a><span class=p>}</span> <span class=k>else</span> <span class=p>{}</span>
</span><span id=__span-1-86><a id=__codelineno-1-86 name=__codelineno-1-86 href=#__codelineno-1-86></a>
</span><span id=__span-1-87><a id=__codelineno-1-87 name=__codelineno-1-87 href=#__codelineno-1-87></a>
</span><span id=__span-1-88><a id=__codelineno-1-88 name=__codelineno-1-88 href=#__codelineno-1-88></a><span class=c>#cleaup</span>
</span><span id=__span-1-89><a id=__codelineno-1-89 name=__codelineno-1-89 href=#__codelineno-1-89></a><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=s2>&quot;C:\temp\custom.inf&quot;</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-1-90><a id=__codelineno-1-90 name=__codelineno-1-90 href=#__codelineno-1-90></a>    <span class=nb>Remove-Item</span> <span class=s2>&quot;C:\temp\custom.inf&quot;</span> <span class=n>-Confirm</span><span class=p>:</span><span class=nv>$false</span>
</span><span id=__span-1-91><a id=__codelineno-1-91 name=__codelineno-1-91 href=#__codelineno-1-91></a><span class=p>}</span>
</span><span id=__span-1-92><a id=__codelineno-1-92 name=__codelineno-1-92 href=#__codelineno-1-92></a>
</span><span id=__span-1-93><a id=__codelineno-1-93 name=__codelineno-1-93 href=#__codelineno-1-93></a><span class=nb>Stop-Transcript</span>
</span></code></pre></div> <nav class=md-post__action> <a href=../../2023/11/09/greenshot-intune-deployment/ > Continue reading </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://avatars.githubusercontent.com/u/6422631 alt="Mike Tupker"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-08 00:00:00">November 8, 2023</time></li> <li class=md-meta__item> in <a href=../../category/linux/ class=md-meta__link>Linux</a>, <a href=../../category/monitoring/ class=md-meta__link>Monitoring</a></li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=btop-is-best-top><a href=../../2023/11/08/btop-is-best-top/ class=toclink>btop is Best Top</a></h2> <p>Usually I use htop, or in the absense of that top, to do basic performance monitoring at a glance. However last week I saw someone post on lemmy about btop. And as the title says, btop is best top (IMO).</p> <p><a href=https://github.com/aristocratos/btop>https://github.com/aristocratos/btop</a></p> <p><img alt="Alt text" src=../../assets/2023-11-08-btop.png></p> <p>btop has most if not all the features of htop with some additions including, network activity and basic disk IO.</p> <p>I was able to install it using the package manager on dietpi and Armbian. For distros though you might need to manually download and run the install script, or just compile from source.</p> <p>I tried the installer script on Almalinux and CentOS 7 and it was pretty straight forward.</p> <p>I'd never seen a tbz file before, but tar can handle them.</p> <div class="language-shell highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>wget<span class=w> </span>https://github.com/aristocratos/btop/releases/download/v1.2.13/btop-x86_64-linux-musl.tbz
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>tar<span class=w> </span>-xjf<span class=w> </span>btop-x86_64-linux-musl.tbz
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nb>cd</span><span class=w> </span>btop
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>./install.sh
</span></code></pre></div> <nav class=md-post__action> <a href=../../2023/11/08/btop-is-best-top/ > Continue reading </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://avatars.githubusercontent.com/u/6422631 alt="Mike Tupker"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-07 00:00:00">November 7, 2023</time></li> <li class=md-meta__item> in <a href=../../category/windows/ class=md-meta__link>Windows</a>, <a href=../../category/server/ class=md-meta__link>Server</a>, <a href=../../category/dns/ class=md-meta__link>DNS</a></li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=ms-dns-logging><a href=../../2023/11/07/ms-dns-logging/ class=toclink>MS DNS Logging</a></h2> <p>For auditing we have to setup our DNS servers to audit various events and queries. </p> <h3 id=set-logging-settings><a class=toclink href=../../2023/11/07/ms-dns-logging/#set-logging-settings>Set logging settings</a></h3> <p>The below command can be run on one of the dns servers. It will enable logging to a file at c:\dnslogs and enable log rollover. <div class="language-powershell highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nv>$setupFolder</span> <span class=p>=</span> <span class=s2>&quot;c:\dnslogs&quot;</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nb>New-Item</span> <span class=n>-Path</span> <span class=nv>$setupFolder</span> <span class=n>-type</span> <span class=n>directory</span> <span class=n>-Force</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nb>Set-DnsServerDiagnostics</span> <span class=p>`</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>-SaveLogsToPersistentStorage</span><span class=p>:</span><span class=nv>$False</span> <span class=p>`</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=n>-Queries</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=n>-Answers</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=n>-Notifications</span><span class=p>:</span><span class=nv>$False</span> <span class=p>`</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=n>-Update</span><span class=p>:</span><span class=nv>$False</span> <span class=p>`</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=n>-QuestionTransactions</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=n>-UnmatchedResponse</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=n>-SendPackets</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=n>-ReceivePackets</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=n>-TcpPackets</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=n>-UdpPackets</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=n>-FullPackets</span><span class=p>:</span><span class=nv>$False</span> <span class=p>`</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=n>-EventLogLevel</span> <span class=n>7</span> <span class=p>`</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=n>-UseSystemEventLog</span><span class=p>:</span><span class=nv>$False</span> <span class=p>`</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=n>-EnableLoggingToFile</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=n>-EnableLogFileRollover</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=n>-LogFilePath</span> <span class=n>C</span><span class=p>:\</span><span class=n>dnslogs</span><span class=p>\</span><span class=n>dns</span><span class=p>.</span><span class=n>log</span> <span class=p>`</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=n>-MaxMBFileSize</span> <span class=n>500000000</span> <span class=p>`</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=n>-WriteThrough</span><span class=p>:</span><span class=nv>$False</span> <span class=p>`</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=n>-EnableLoggingForLocalLookupEvent</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=n>-EnableLoggingForPluginDllEvent</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a><span class=n>-EnableLoggingForRecursiveLookupEvent</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=n>-EnableLoggingForRemoteServerEvent</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a><span class=n>-EnableLoggingForServerStartStopEvent</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a><span class=n>-EnableLoggingForTombstoneEvent</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a><span class=n>-EnableLoggingForZoneDataWriteEvent</span><span class=p>:</span><span class=nv>$True</span> <span class=p>`</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a><span class=n>-EnableLoggingForZoneLoadingEvent</span><span class=p>:</span><span class=nv>$True</span>
</span></code></pre></div></p> <h3 id=replicate-logging-settings><a class=toclink href=../../2023/11/07/ms-dns-logging/#replicate-logging-settings>Replicate logging settings</a></h3> <p>Change the DC name to match the one that you setup logging on. The command will get all the settings from that server and then copy them to the remaining DCs in the domain. <div class="language-powershell highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nv>$settings</span> <span class=p>=</span> <span class=nb>Get-DnsServerDiagnostics</span> <span class=n>-ComputerName</span> <span class=n>DC01</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=nv>$dcs</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-ADDomainController</span> <span class=n>-Filter</span> <span class=p>*).</span><span class=n>HostName</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=k>foreach</span> <span class=p>(</span><span class=nv>$dc</span> <span class=k>in</span> <span class=nv>$dcs</span><span class=p>)</span> <span class=p>{</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>    <span class=c># create dnslogs folder</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    <span class=nb>Invoke-Command</span> <span class=n>-ComputerName</span> <span class=nv>$dc</span> <span class=n>-ScriptBlock</span> <span class=p>{</span> 
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>        <span class=nv>$setupFolder</span> <span class=p>=</span> <span class=s2>&quot;c:\dnslogs&quot;</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>        <span class=nb>New-Item</span> <span class=n>-Path</span> <span class=nv>$setupFolder</span> <span class=n>-type</span> <span class=n>directory</span> <span class=n>-Force</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>    <span class=p>}</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>    <span class=nv>$settings</span> <span class=p>|</span> <span class=nb>Set-DnsServerDiagnostics</span> <span class=n>-ComputerName</span> <span class=nv>$dc</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=p>}</span>
</span></code></pre></div></p> <nav class=md-post__action> <a href=../../2023/11/07/ms-dns-logging/ > Continue reading </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://avatars.githubusercontent.com/u/6422631 alt="Mike Tupker"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-06 00:00:00">November 6, 2023</time></li> <li class=md-meta__item> in <a href=../../category/powershell/ class=md-meta__link>Powershell</a>, <a href=../../category/scripting/ class=md-meta__link>Scripting</a>, <a href=../../category/active-directory/ class=md-meta__link>Active Directory</a></li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=force-ad-replication><a href=../../2023/11/06/force-ad-replication/ class=toclink>Force AD Replication</a></h2> <p>The below script will get all domain controllers in the current domain and then run a repadmin /syncall on all of them.</p> <div class="language-powershell highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=p>(</span><span class=nb>Get-ADDomainController</span> <span class=n>-Filter</span> <span class=p>*).</span><span class=n>Name</span> <span class=p>|</span> <span class=k>Foreach</span><span class=n>-Object</span> <span class=p>{</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=n>repadmin</span> <span class=p>/</span><span class=n>syncall</span> <span class=nv>$_</span> <span class=p>(</span><span class=nb>Get-ADDomain</span><span class=p>).</span><span class=n>DistinguishedName</span> <span class=p>/</span><span class=n>e</span> <span class=p>/</span><span class=n>A</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=p>}</span>
</span></code></pre></div> <nav class=md-post__action> <a href=../../2023/11/06/force-ad-replication/ > Continue reading </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://avatars.githubusercontent.com/u/6422631 alt="Mike Tupker"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-04 00:00:00">November 4, 2023</time></li> <li class=md-meta__item> in <a href=../../category/windows/ class=md-meta__link>Windows</a>, <a href=../../category/ntp/ class=md-meta__link>ntp</a>, <a href=../../category/aws/ class=md-meta__link>aws</a></li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=configure-windows-time><a href=../../2023/11/04/configure-windows-time/ class=toclink>Configure Windows Time</a></h2> <h3 id=ad-members><a class=toclink href=../../2023/11/04/configure-windows-time/#ad-members>AD members</a></h3> <p>This will reset a domain member to use NT5DS to set the time. This should be the default for "most" domain environments <div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>net stop w32time
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>w32tm /unregister
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>w32tm /register
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>net start w32time
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>w32tm /config /syncfromflags:DOMHIER /update
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>net stop w32time
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>net start w32time
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>w32tm /resync /rediscover /nowait
</span></code></pre></div></p> <h3 id=ad-pdc><a class=toclink href=../../2023/11/04/configure-windows-time/#ad-pdc>AD PDC</a></h3> <p>In most setups the PDC should be configured to sync with an external time source. Other domain controllers should sync to it. The below command simply sets the PDC to sync with the NIST time source. <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>net stop w32time
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>w32tm /unregister
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>w32tm /register
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>net start w32time
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>w32tm.exe /config /manualpeerlist:&quot;time.nist.gov,0x8&quot; /syncfromflags:manual /reliable:YES /update
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>net stop w32time
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>net start w32time
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>w32tm /resync /nowait
</span></code></pre></div></p> <h3 id=set-timezone><a class=toclink href=../../2023/11/04/configure-windows-time/#set-timezone>Set timezone</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>tzutil /s &quot;Central Standard Time&quot;
</span></code></pre></div> <h3 id=troubleshooting><a class=toclink href=../../2023/11/04/configure-windows-time/#troubleshooting>Troubleshooting</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>w32tm /resync /rediscover
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>w32tm /query /status /verbose
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>w32tm /query /configuration
</span></code></pre></div> <h3 id=aws-workspace-default><a class=toclink href=../../2023/11/04/configure-windows-time/#aws-workspace-default>AWS Workspace Default</a></h3> <p>Below is the new time settings for AWS machines. This command is if you want to revert to the default setting for AWS. <div class="language-text highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>w32tm /config /manualpeerlist:&quot;169.254.169.123,0x9 time.windows.com,0x8&quot; /syncfromflags:manual /update
</span></code></pre></div></p> <nav class=md-post__action> <a href=../../2023/11/04/configure-windows-time/ > Continue reading </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://avatars.githubusercontent.com/u/6422631 alt="Mike Tupker"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2023-11-03 00:00:00">November 3, 2023</time></li> <li class=md-meta__item> in <a href=../../category/windows/ class=md-meta__link>Windows</a></li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=cleanup-winsxs><a href=../../2023/11/03/cleanup-winsxs/ class=toclink>Cleanup WinSXS</a></h2> <p>From: <a href="https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/clean-up-the-winsxs-folder?view=windows-11">https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/clean-up-the-winsxs-folder?view=windows-11</a></p> <h3 id=analyze-component-store><a class=toclink href=../../2023/11/03/cleanup-winsxs/#analyze-component-store>Analyze component store</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>dism /Online /Cleanup-Image /AnalyzeComponentStore
</span></code></pre></div> <h3 id=remove-previous-versions-of-updated-components><a class=toclink href=../../2023/11/03/cleanup-winsxs/#remove-previous-versions-of-updated-components>Remove previous versions of updated components</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>Dism.exe /online /Cleanup-Image /StartComponentCleanup
</span></code></pre></div> <h3 id=remove-all-superseded-versions-of-components><a class=toclink href=../../2023/11/03/cleanup-winsxs/#remove-all-superseded-versions-of-components>Remove all superseded versions of components</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>Dism.exe /online /Cleanup-Image /StartComponentCleanup /ResetBase
</span></code></pre></div> <nav class=md-post__action> <a href=../../2023/11/03/cleanup-winsxs/ > Continue reading </a> </nav> </div> </article> <nav class=md-pagination> </nav> </div> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copywrite 2023 Mike Tupker </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/tupcakes target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.copy", "content.code.select", "navigation.instant", "navigation.tracking", "navigation.path", "navigation.top", "search.highlight", "search.suggest"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.81fa17fe.min.js></script> </body> </html>